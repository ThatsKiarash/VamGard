@model List<VamYab.Models.BlogPost>
@{
    ViewData["Title"] = "وبلاگ وام‌گرد";
    ViewData["MetaDescription"] = "آخرین مقالات و اخبار حوزه بانکی، وام و تسهیلات در وبلاگ وام‌گرد";
    var currentPage = (int)ViewBag.CurrentPage;
    var totalPages = (int)ViewBag.TotalPages;
}

<div class="section">
    <div class="container">
        <nav aria-label="breadcrumb" class="mb-3">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a asp-controller="Home" asp-action="Index">خانه</a></li>
                <li class="breadcrumb-item active">وبلاگ</li>
            </ol>
        </nav>

        <div class="section-header">
            <h2><span class="icon-box" style="background:rgba(37,99,235,.1);color:#2563eb;"><i class="bi bi-journal-richtext"></i></span> وبلاگ وام‌گرد</h2>
            <span class="text-muted">@ViewBag.TotalCount مطلب</span>
        </div>

        @{
            var categories = ViewBag.Categories as List<string> ?? new();
            var currentCat = ViewBag.CurrentCategory as string;
        }
        @if (categories.Any())
        {
            <div class="d-flex flex-wrap gap-2 mb-4">
                <a href="/Blog" class="btn btn-sm @(string.IsNullOrEmpty(currentCat) ? "btn-primary" : "btn-outline-primary")" style="border-radius:20px;">همه</a>
                @foreach (var cat in categories)
                {
                    <a href="/Blog?category=@Uri.EscapeDataString(cat)" class="btn btn-sm @(currentCat == cat ? "btn-primary" : "btn-outline-primary")" style="border-radius:20px;">@cat</a>
                }
            </div>
        }

        @if (Model.Count == 0)
        {
            <div class="text-center py-5">
                <i class="bi bi-journal-x" style="font-size:3rem;color:var(--slate-light);"></i>
                <p class="mt-3 text-muted">هنوز مطلبی در وبلاگ منتشر نشده است.</p>
            </div>
        }
        else
        {
            <div class="row g-4">
                @foreach (var post in Model)
                {
                    <div class="col-md-6 col-lg-4">
                        <div class="card h-100" style="border-radius:16px;">
                            @if (!string.IsNullOrEmpty(post.CoverImageUrl))
                            {
                                <img src="@post.CoverImageUrl" alt="@post.Title" style="height:180px;object-fit:cover;border-radius:16px 16px 0 0;" loading="lazy" />
                            }
                            else
                            {
                                <div style="height:180px;border-radius:16px 16px 0 0;background:linear-gradient(135deg,#2563eb,#059669);display:flex;align-items:center;justify-content:center;">
                                    <i class="bi bi-journal-richtext" style="font-size:3rem;color:rgba(255,255,255,.3);"></i>
                                </div>
                            }
                            <div class="card-body d-flex flex-column">
                                <h5 style="font-weight:700;font-size:.95rem;">
                                    <a href="/blog/@post.Slug" style="color:var(--text);text-decoration:none;">@post.Title</a>
                                </h5>
                                @if (!string.IsNullOrEmpty(post.Summary))
                                {
                                    <p style="color:var(--text-muted);font-size:.84rem;line-height:1.7;">@post.Summary</p>
                                }
                                <div class="mt-auto d-flex justify-content-between align-items-center" style="font-size:.78rem;color:var(--slate);">
                                    <span><i class="bi bi-calendar3"></i> @(post.PublishedAt?.ToString("yyyy/MM/dd") ?? "")</span>
                                    <span><i class="bi bi-eye"></i> @post.ViewCount بازدید</span>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>

            @if (totalPages > 1)
            {
                <nav class="mt-4 d-flex justify-content-center">
                    <ul class="pagination">
                        @for (int i = 1; i <= totalPages; i++)
                        {
                            <li class="page-item @(i == currentPage ? "active" : "")">
                                <a class="page-link" asp-action="Index" asp-route-page="@i" asp-route-category="@currentCat">@i</a>
                            </li>
                        }
                    </ul>
                </nav>
            }
        }
    </div>
</div>

<script type="application/ld+json">
{
    "@@context": "https://schema.org",
    "@@type": "Blog",
    "name": "وبلاگ وام‌گرد",
    "description": "آخرین مقالات و اخبار حوزه بانکی و وام",
    "url": "https://vamgard.org/Blog"
}
</script>
