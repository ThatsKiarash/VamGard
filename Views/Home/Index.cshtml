@{
    ViewData["Title"] = "مرجع جامع مقایسه وام‌های بانکی ایران";
    ViewData["MetaDescription"] = "وام‌گرد: مرجع جامع مقایسه انواع وام‌های بانکی ایران. وام مسکن، وام ازدواج، وام خودرو، قرض‌الحسنه و سایر تسهیلات. اطلاعات به‌روز شرایط و نرخ سود.";
    var featuredLoans = ViewBag.FeaturedLoans as List<Loan> ?? new();
    var hotLoans = ViewBag.HotLoans as List<Loan> ?? new();
    var latestLoans = ViewBag.LatestLoans as List<Loan> ?? new();
    var allBanks = ViewBag.Banks as List<Bank> ?? new();
    var banks = allBanks.Where(b => b.BankType == "bank").ToList();
    var loanTypes = ViewBag.LoanTypes as List<LoanType> ?? new();
    var bubbleLoans = ViewBag.BubbleLoans as List<Loan> ?? new();
}

<section class="hero">
    <div class="container hero-content">
        <div class="text-center" style="max-width:680px;margin:0 auto;position:relative;">
            <h1>مقایسه وام‌های بانکی<br />در <em>وام‌گرد</em></h1>
            <p class="mt-3 mx-auto">شرایط، نرخ سود و مبلغ وام‌های تمام بانک‌ها را مقایسه کنید.</p>

            <!-- Rotating loan bubbles (decorative) -->
            <div class="loan-bubbles-container" aria-hidden="true">
                <div class="loan-bubble bubble-0" id="bubble0"></div>
                <div class="loan-bubble bubble-1" id="bubble1"></div>
            </div>
            <script id="bubbleData" type="application/json">@Html.Raw(System.Text.Json.JsonSerializer.Serialize(bubbleLoans.Select(bl => new { logo = bl.Bank.LogoUrl ?? "", bank = bl.Bank.Name, type = bl.LoanType.Name, rate = bl.InterestRate, max = bl.MaxAmount })))</script>

            <form asp-controller="Loans" asp-action="Index" method="get" class="apple-search mt-4">
                <i class="bi bi-search search-icon"></i>
                <input type="text" name="q" placeholder="جستجوی وام... مثلاً وام ازدواج، وام مسکن" autocomplete="off" />
                <button type="submit">جستجو</button>
            </form>
            <div class="hero-stats justify-content-center mt-3">
                <div class="hero-stat"><strong>@ViewBag.TotalLoans</strong> وام فعال</div>
                <div class="hero-stat"><strong>@ViewBag.TotalBanks</strong> بانک</div>
                <div class="hero-stat"><strong>@ViewBag.TotalLoanTypes</strong> دسته‌بندی</div>
            </div>
        </div>

        @{
            var carouselBanks = allBanks.Where(b => b.Loans.Any(l => l.IsActive)).ToList();
        }
        <div class="hero-banks">
            <div class="carousel-wrapper">
                <div class="carousel-track" id="bankCarousel">
                    @foreach (var bank in carouselBanks)
                    {
                        var bankLoans = bank.Loans.Where(l => l.IsActive).ToList();
                        <div class="bank-show-item" data-original="1">
                            <a href="/bank/@bank.Slug" class="bank-show-header">
                                <div class="bank-show-logo-wrap">
                                    @if (!string.IsNullOrEmpty(bank.LogoUrl))
                                    {
                                        <img src="@bank.LogoUrl" alt="@bank.Name" class="bank-show-logo" loading="lazy" />
                                    }
                                    else
                                    {
                                        <div class="bank-show-logo d-flex align-items-center justify-content-center"><i class="bi bi-bank2"></i></div>
                                    }
                                </div>
                                <div class="bank-show-name">
                                    @bank.Name
                                    @if (bank.BankType == "neobank")
                                    {
                                        <span class="bank-badge-neo">ترابانک</span>
                                    }
                                </div>
                                <small class="bank-show-count">@bankLoans.Count وام فعال</small>
                            </a>
                            <div class="bank-loan-chips">
                                @foreach (var loan in bankLoans.Take(3))
                                {
                                    <a href="/vam/@loan.Slug" class="bank-loan-chip">
                                        @loan.LoanType.Name
                                        @if (loan.InterestRate.HasValue)
                                        {
                                            <span class="chip-rate">@loan.InterestRate%</span>
                                        }
                                    </a>
                                }
                                @if (bankLoans.Count > 3)
                                {
                                    <a href="/bank/@bank.Slug" class="bank-loan-chip chip-more">+@(bankLoans.Count - 3) دیگر</a>
                                }
                            </div>
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="section-header">
            <h2><span class="icon-box" style="background:var(--blue-glow);color:var(--blue);"><i class="bi bi-grid-3x3-gap-fill"></i></span> دسته‌بندی وام‌ها</h2>
            <a asp-controller="Loans" asp-action="Index" class="btn-outline-custom text-decoration-none">مشاهده همه <i class="bi bi-arrow-left"></i></a>
        </div>
        <div class="row g-3">
            @foreach (var lt in loanTypes)
            {
                <div class="col-6 col-md-4 col-lg-3">
                    <a href="/type/@lt.Slug" class="type-card">
                        <div class="type-icon"><i class="bi @(lt.IconClass ?? "bi-cash-coin")"></i></div>
                        <h6>@lt.Name</h6>
                        @if (!string.IsNullOrEmpty(lt.Description))
                        {
                            <small style="color:var(--text-muted);font-size:.76rem;">@lt.Description</small>
                        }
                    </a>
                </div>
            }
        </div>
    </div>
</section>

@if (hotLoans.Any())
{
    <section class="section section-alt">
        <div class="container">
            <div class="section-header">
                <h2><span class="icon-box" style="background:rgba(220,38,38,.1);color:var(--red);"><i class="bi bi-fire"></i></span> داغ‌ترین وام‌ها</h2>
                <a asp-controller="Loans" asp-action="Index" class="btn-outline-custom text-decoration-none">همه وام‌ها <i class="bi bi-arrow-left"></i></a>
            </div>
            <div class="row g-4">
                @foreach (var loan in hotLoans)
                {
                    <div class="col-md-6 col-lg-4">@await Html.PartialAsync("_LoanCard", loan, new ViewDataDictionary(ViewData) { { "Badge", "hot" } })</div>
                }
            </div>
        </div>
    </section>
}

@if (featuredLoans.Any())
{
    <section class="section">
        <div class="container">
            <div class="section-header">
                <h2><span class="icon-box" style="background:rgba(217,119,6,.1);color:var(--amber);"><i class="bi bi-star-fill"></i></span> وام‌های ویژه</h2>
            </div>
            <div class="row g-4">
                @foreach (var loan in featuredLoans)
                {
                    <div class="col-md-6 col-lg-4">@await Html.PartialAsync("_LoanCard", loan, new ViewDataDictionary(ViewData) { { "Badge", "featured" } })</div>
                }
            </div>
        </div>
    </section>
}

@if (latestLoans.Any())
{
    <section class="section section-alt">
        <div class="container">
            <div class="section-header">
                <h2><span class="icon-box" style="background:rgba(5,150,105,.1);color:var(--emerald);"><i class="bi bi-clock-history"></i></span> جدیدترین وام‌ها</h2>
            </div>
            <div class="row g-4">
                @foreach (var loan in latestLoans)
                {
                    <div class="col-md-6 col-lg-4">@await Html.PartialAsync("_LoanCard", loan)</div>
                }
            </div>
        </div>
    </section>
}

<section class="section">
    <div class="container">
        <div class="section-header">
            <h2><span class="icon-box" style="background:var(--blue-glow);color:var(--blue);"><i class="bi bi-bank2"></i></span> بانک‌ها</h2>
            <a asp-controller="Banks" asp-action="Index" class="btn-outline-custom text-decoration-none">همه بانک‌ها <i class="bi bi-arrow-left"></i></a>
        </div>
        <div class="row g-3">
            @foreach (var bank in banks)
            {
                <div class="col-6 col-md-4 col-lg-3">
                    <a href="/bank/@bank.Slug" class="bank-card d-block">
                        @if (!string.IsNullOrEmpty(bank.LogoUrl))
                        {
                            <img src="@bank.LogoUrl" alt="@bank.Name" class="bank-card-logo" loading="lazy" />
                        }
                        else
                        {
                            <div class="bank-card-logo d-flex align-items-center justify-content-center" style="background:var(--navy);color:#fff;font-size:1.4rem;"><i class="bi bi-bank2"></i></div>
                        }
                        <h6 class="fw-bold mb-1" style="font-size:.92rem;">@bank.Name</h6>
                        <small style="color:var(--text-muted);">@bank.Loans.Count(l => l.IsActive) وام فعال</small>
                    </a>
                </div>
            }
        </div>
    </div>
</section>

<script type="application/ld+json">
{
    "@@context": "https://schema.org",
    "@@type": "WebSite",
    "name": "وام‌گرد",
    "alternateName": "VamGard",
    "url": "https://vamgard.org",
    "description": "مرجع جامع مقایسه انواع وام‌های بانکی ایران",
    "inLanguage": "fa",
    "potentialAction": {
        "@@type": "SearchAction",
        "target": "https://vamgard.org/Loans?q={search_term_string}",
        "query-input": "required name=search_term_string"
    }
}
</script>
