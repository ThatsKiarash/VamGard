@model VamYab.Models.BlogPost
@{
    ViewData["Title"] = "ویرایش مطلب";
}

<div class="card bg-white p-4" style="border-radius:16px;border:none;box-shadow:0 2px 10px rgba(0,0,0,.05);">
    <h5 class="fw-bold mb-3">ویرایش مطلب: @Model.Title</h5>
    <form asp-action="Edit" asp-route-id="@Model.Id" method="post" enctype="multipart/form-data">
        @Html.AntiForgeryToken()
        <input type="hidden" asp-for="Id" />
        <div class="row g-3">
            <div class="col-md-8">
                <label asp-for="Title" class="form-label"></label>
                <input asp-for="Title" class="form-control" />
                <span asp-validation-for="Title" class="text-danger"></span>
            </div>
            <div class="col-md-4">
                <label asp-for="Slug" class="form-label"></label>
                <input asp-for="Slug" class="form-control" />
                <span asp-validation-for="Slug" class="text-danger"></span>
            </div>
            <div class="col-12">
                <label asp-for="Summary" class="form-label"></label>
                <textarea asp-for="Summary" class="form-control" rows="2"></textarea>
            </div>
            <div class="col-12">
                <label asp-for="Content" class="form-label"></label>
                <textarea asp-for="Content" class="form-control" rows="12"></textarea>
                <span asp-validation-for="Content" class="text-danger"></span>
            </div>
            <div class="col-md-6">
                <label class="form-label">تصویر کاور (آپلود فایل جدید)</label>
                <input type="file" name="coverImage" class="form-control" accept="image/*" id="coverFile" />
                @if (!string.IsNullOrEmpty(Model.CoverImageUrl))
                {
                    <div class="mt-2">
                        <img src="@Model.CoverImageUrl" style="max-height:120px;border-radius:10px;" />
                        <small class="d-block text-muted mt-1">تصویر فعلی</small>
                    </div>
                }
                <div id="coverPreview" class="mt-2" style="display:none;">
                    <img id="previewImg" style="max-height:150px;border-radius:10px;" />
                    <small class="d-block text-muted mt-1">تصویر جدید</small>
                </div>
            </div>
            <div class="col-md-6">
                <label asp-for="CoverImageUrl" class="form-label">یا لینک تصویر</label>
                <input asp-for="CoverImageUrl" class="form-control" />
            </div>
            <div class="col-md-6">
                <label asp-for="MetaTitle" class="form-label"></label>
                <input asp-for="MetaTitle" class="form-control" />
            </div>
            <div class="col-md-6">
                <label asp-for="MetaDescription" class="form-label"></label>
                <input asp-for="MetaDescription" class="form-control" />
            </div>
            <div class="col-md-6">
                <label asp-for="MetaKeywords" class="form-label"></label>
                <input asp-for="MetaKeywords" class="form-control" />
            </div>
            <div class="col-md-4">
                <label asp-for="Category" class="form-label"></label>
                <input asp-for="Category" class="form-control" placeholder="مثال: آموزشی، اخبار، تحلیل" />
            </div>
            <div class="col-md-4">
                <label asp-for="Tags" class="form-label"></label>
                <input asp-for="Tags" class="form-control" placeholder="تگ‌ها با کاما جدا شوند" />
            </div>
            <div class="col-md-6">
                <label asp-for="RelatedLoanIds" class="form-label"></label>
                <input asp-for="RelatedLoanIds" class="form-control" placeholder="شناسه وام‌ها با کاما مثل: 1,5,12" />
                <small class="text-muted">شناسه وام‌های مرتبط با این مقاله</small>
            </div>
            <div class="col-12">
                <div class="form-check">
                    <input asp-for="IsPublished" class="form-check-input" />
                    <label asp-for="IsPublished" class="form-check-label"></label>
                </div>
            </div>
        </div>
        <div class="mt-3">
            <button type="submit" class="btn btn-primary"><i class="bi bi-check-lg"></i> ذخیره تغییرات</button>
            <a asp-action="Index" class="btn btn-outline-secondary">انصراف</a>
        </div>
    </form>
</div>
<script>
document.getElementById('coverFile').addEventListener('change', function(e) {
    var f = e.target.files[0];
    if (f) {
        var r = new FileReader();
        r.onload = function(ev) {
            document.getElementById('previewImg').src = ev.target.result;
            document.getElementById('coverPreview').style.display = 'block';
        };
        r.readAsDataURL(f);
    }
});
</script>
